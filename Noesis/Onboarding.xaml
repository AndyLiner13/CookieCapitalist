<!--
  Onboarding - Tutorial overlay with mascot and chat system
  Display Mode: Screen Overlay, Render Order: 150 (above everything)
  Input Mode: Interactive, blocking
  
  This XAML only contains the mascot, chat bubble, tap prompt, and swipe animation.
  The actual "dimming" of UI elements is done by each individual UI file
  (Overlay.xaml, Cookie.xaml, etc.) via their own onboardingDimmed binding.
  
  DataContext bindings:
  - isVisible: Overall visibility
  - showSwipeAnimation: Show swipe down tutorial
  - showChatBubble: Show mascot chat bubble
  - showTapPrompt: Show "tap to continue"
  - chatText: Text for chat bubble
-->

<Page
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  mc:Ignorable="d"
  d:DesignWidth="393"
  d:DesignHeight="852">

  <Page.Resources>
    <ResourceDictionary>
      <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </ResourceDictionary>
  </Page.Resources>

  <!-- Main container - IsHitTestVisible controlled by allowTapAnywhere -->
  <Grid HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
        Visibility="{Binding isVisible, Converter={StaticResource BoolToVis}}"
        IsHitTestVisible="{Binding allowTapAnywhere}">
    
    <!-- Tap anywhere button - disabled when waiting for cookie/swipe interaction -->
    <Button Command="{Binding onTapToContinue}" 
            HorizontalAlignment="Stretch" 
            VerticalAlignment="Stretch"
            HorizontalContentAlignment="Stretch"
            VerticalContentAlignment="Stretch">
      <Button.Template>
        <ControlTemplate TargetType="Button">
          <Grid HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Background="Transparent">
            
            <!-- ═══════════════════════════════════════════════════════════════════════════════ -->
            <!-- SWIPE DOWN ANIMATION                                                           -->
            <!-- ═══════════════════════════════════════════════════════════════════════════════ -->
            <Grid HorizontalAlignment="Center" VerticalAlignment="Center"
                  Visibility="{Binding showSwipeAnimation, Converter={StaticResource BoolToVis}}"
                  Margin="0,50,0,0">
              <Border x:Name="SwipeIcon" RenderTransformOrigin="0.5,0.5" Width="60" Height="60">
                <Border.RenderTransform>
                  <TranslateTransform x:Name="SwipeTranslate" Y="0"/>
                </Border.RenderTransform>
                <Border.Triggers>
                  <EventTrigger RoutedEvent="Border.Loaded">
                    <BeginStoryboard>
                      <Storyboard RepeatBehavior="Forever">
                        <DoubleAnimation Storyboard.TargetName="SwipeTranslate"
                                         Storyboard.TargetProperty="Y"
                                         From="-80" To="80" Duration="0:0:1.2">
                          <DoubleAnimation.EasingFunction>
                            <QuadraticEase EasingMode="EaseInOut"/>
                          </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>
                        <DoubleAnimation Storyboard.TargetName="SwipeIconOpacity"
                                         Storyboard.TargetProperty="Opacity"
                                         From="0" To="1" Duration="0:0:0.3"/>
                        <DoubleAnimation Storyboard.TargetName="SwipeIconOpacity"
                                         Storyboard.TargetProperty="Opacity"
                                         From="1" To="0" Duration="0:0:0.3"
                                         BeginTime="0:0:0.9"/>
                      </Storyboard>
                    </BeginStoryboard>
                  </EventTrigger>
                </Border.Triggers>
                <Border x:Name="SwipeIconOpacity" Opacity="0">
                  <Image Source="Images/MiddleTab.png" Width="50" Height="50" Stretch="Uniform"/>
                </Border>
              </Border>
              <TextBlock Text="↓" FontFamily="Fonts/#Anton-Regular" FontSize="48" Foreground="#FFD700"
                         HorizontalAlignment="Center" VerticalAlignment="Bottom" Margin="0,0,0,-60">
                <TextBlock.Effect>
                  <DropShadowEffect Color="#000000" BlurRadius="4" ShadowDepth="2" Opacity="0.8"/>
                </TextBlock.Effect>
              </TextBlock>
            </Grid>
            
            <!-- ═══════════════════════════════════════════════════════════════════════════════ -->
            <!-- ENCOURAGEMENT TEXT (Multiplier Challenge)                                      -->
            <!-- ═══════════════════════════════════════════════════════════════════════════════ -->
            <Grid HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,120,0,0"
                  Visibility="{Binding showEncouragementText, Converter={StaticResource BoolToVis}}">
              
              <Border x:Name="EncouragementContainer" RenderTransformOrigin="0.5,0.5"
                      CornerRadius="24"
                      Padding="40,20"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center">
                <Border.Background>
                  <SolidColorBrush Color="#FFD700"/>
                </Border.Background>
                <Border.RenderTransform>
                  <ScaleTransform x:Name="EncouragementScale" ScaleX="1" ScaleY="1"/>
                </Border.RenderTransform>
                <Border.Triggers>
                  <EventTrigger RoutedEvent="Border.Loaded">
                    <BeginStoryboard>
                      <Storyboard RepeatBehavior="Forever">
                        <DoubleAnimation Storyboard.TargetName="EncouragementScale"
                                         Storyboard.TargetProperty="ScaleX"
                                         From="1" To="1.1" Duration="0:0:0.6"
                                         AutoReverse="True">
                          <DoubleAnimation.EasingFunction>
                            <SineEase EasingMode="EaseInOut"/>
                          </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>
                        <DoubleAnimation Storyboard.TargetName="EncouragementScale"
                                         Storyboard.TargetProperty="ScaleY"
                                         From="1" To="1.1" Duration="0:0:0.6"
                                         AutoReverse="True">
                          <DoubleAnimation.EasingFunction>
                            <SineEase EasingMode="EaseInOut"/>
                          </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>
                      </Storyboard>
                    </BeginStoryboard>
                  </EventTrigger>
                </Border.Triggers>
                <Border.Effect>
                  <DropShadowEffect Color="#000000" BlurRadius="12" ShadowDepth="3" Opacity="0.4"/>
                </Border.Effect>
                
                <TextBlock Text="{Binding encouragementText}"
                           FontFamily="Fonts/#Bangers-Regular"
                           FontSize="48"
                           Foreground="#000000"
                           TextAlignment="Center"/>
              </Border>
              
            </Grid>
            
            <!-- ═══════════════════════════════════════════════════════════════════════════════ -->
            <!-- MASCOT + CHAT BUBBLE                                                           -->
            <!-- ═══════════════════════════════════════════════════════════════════════════════ -->
            <Grid HorizontalAlignment="Center" VerticalAlignment="Bottom" Margin="0,0,0,120">
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="120"/>
              </Grid.RowDefinitions>
              
              <Border Grid.Row="0"
                      CornerRadius="20"
                      Padding="32,28"
                      Margin="0,0,0,16"
                      MaxWidth="320"
                      MinWidth="260"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Bottom"
                      Visibility="{Binding showChatBubble, Converter={StaticResource BoolToVis}}">
                <Border.Background>
                  <SolidColorBrush Color="#FFFFFF"/>
                </Border.Background>
                <Border.Effect>
                  <DropShadowEffect Color="#000000" BlurRadius="16" ShadowDepth="4" Opacity="0.3"/>
                </Border.Effect>
                
                <StackPanel Orientation="Vertical">
                  <TextBlock Text="{Binding chatText}"
                             FontFamily="Fonts/#Anton-Regular"
                             FontSize="20"
                             Foreground="#333333"
                             TextWrapping="Wrap"
                             TextAlignment="Center"
                             LineHeight="30"/>
                </StackPanel>
              </Border>
              
              <Border Grid.Row="1" 
                      HorizontalAlignment="Center" 
                      VerticalAlignment="Top"
                      Width="120" 
                      Height="120">
                <Image Source="Images/MascotImage.png" Stretch="Uniform"/>
              </Border>
              
            </Grid>
            
            <!-- ═══════════════════════════════════════════════════════════════════════════════ -->
            <!-- TAP TO CONTINUE PROMPT                                                         -->
            <!-- ═══════════════════════════════════════════════════════════════════════════════ -->
            <StackPanel Orientation="Vertical" 
                        HorizontalAlignment="Center" 
                        VerticalAlignment="Bottom"
                        Margin="0,0,0,40"
                        Visibility="{Binding showTapPrompt, Converter={StaticResource BoolToVis}}">
              
              <Border x:Name="TapPromptContainer" RenderTransformOrigin="0.5,0.5">
                <Border.RenderTransform>
                  <ScaleTransform x:Name="TapPromptScale" ScaleX="1" ScaleY="1"/>
                </Border.RenderTransform>
                <Border.Triggers>
                  <EventTrigger RoutedEvent="Border.Loaded">
                    <BeginStoryboard>
                      <Storyboard RepeatBehavior="Forever">
                        <DoubleAnimation Storyboard.TargetName="TapPromptScale"
                                         Storyboard.TargetProperty="ScaleX"
                                         From="1" To="1.05" Duration="0:0:0.8"
                                         AutoReverse="True">
                          <DoubleAnimation.EasingFunction>
                            <SineEase EasingMode="EaseInOut"/>
                          </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>
                        <DoubleAnimation Storyboard.TargetName="TapPromptScale"
                                         Storyboard.TargetProperty="ScaleY"
                                         From="1" To="1.05" Duration="0:0:0.8"
                                         AutoReverse="True">
                          <DoubleAnimation.EasingFunction>
                            <SineEase EasingMode="EaseInOut"/>
                          </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>
                      </Storyboard>
                    </BeginStoryboard>
                  </EventTrigger>
                </Border.Triggers>
                
                <Grid>
                  <TextBlock Text="Tap to continue" FontFamily="Fonts/#Anton-Regular" FontSize="24"
                             Foreground="#000000" TextAlignment="Center" Margin="0,0,2,2"/>
                  <TextBlock Text="Tap to continue" FontFamily="Fonts/#Anton-Regular" FontSize="24"
                             Foreground="#000000" TextAlignment="Center" Margin="2,0,0,2"/>
                  <TextBlock Text="Tap to continue" FontFamily="Fonts/#Anton-Regular" FontSize="24"
                             Foreground="#000000" TextAlignment="Center" Margin="0,2,2,0"/>
                  <TextBlock Text="Tap to continue" FontFamily="Fonts/#Anton-Regular" FontSize="24"
                             Foreground="#000000" TextAlignment="Center" Margin="2,2,0,0"/>
                  <TextBlock Text="Tap to continue" FontFamily="Fonts/#Anton-Regular" FontSize="24"
                             Foreground="#FFFFFF" TextAlignment="Center" Margin="1,1,1,1"/>
                </Grid>
              </Border>
              
            </StackPanel>
            
          </Grid>
        </ControlTemplate>
      </Button.Template>
    </Button>
    
  </Grid>

</Page>